apiVersion: addons.cluster.x-k8s.io/v1alpha1
kind: FleetAddonConfig
metadata:
  name: fleet-addon-config
spec:
  config:
    featureGates:
      configMap:
        ref:
          kind: ConfigMap
          apiVersion: v1
          name: rancher-config
          namespace: cattle-system
      experimentalOciStorage: true
      experimentalHelmOps: true
  clusterClass:
    patchResource: true
    setOwnerReferences: true
  cluster:
    agentNamespace: cattle-fleet-system
    applyClassGroup: true
    patchResource: false #Workaround for: https://github.com/rancher/cluster-api-addon-provider-fleet/issues/313
    setOwnerReferences: true
    hostNetwork: true
    selector:
      matchLabels:
        cluster-api.cattle.io/rancher-auto-import: "true"
      matchExpressions:
        - key: cluster-api.cattle.io/disable-fleet-auto-import
          operator: DoesNotExist
    namespaceSelector:
      matchLabels:
        cluster-api.cattle.io/rancher-auto-import: "true"
      matchExpressions:
        - key: cluster-api.cattle.io/disable-fleet-auto-import
          operator: DoesNotExist
